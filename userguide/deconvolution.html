

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1.2. Spatially invariant deconvolution &mdash; torchmfbd 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1.3. Spatially variant deconvolution" href="deconvolutionSV.html" />
    <link rel="prev" title="1.1. Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            torchmfbd
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../userguide.html">1. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">1.1. Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.2. Spatially invariant deconvolution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">1.2.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">1.2.2. Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output">1.2.3. Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-filter">1.2.4. Modifying filter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deconvolutionSV.html">1.3. Spatially variant deconvolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="diversity.html">1.4. Phase diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">1.5. Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="patches.html">1.6. Mosaicking</a></li>
<li class="toctree-l2"><a class="reference internal" href="destretch.html">1.7. Destretching</a></li>
<li class="toctree-l2"><a class="reference internal" href="destretch.html#alignment">1.8. Alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="regularization.html">1.9. Regularization</a></li>
<li class="toctree-l2"><a class="reference internal" href="movie.html">1.10. Movie</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">2. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../disclaimer.html">3. Disclaimer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">torchmfbd</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../userguide.html"><span class="section-number">1. </span>User guide</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1.2. </span>Spatially invariant deconvolution</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/userguide/deconvolution.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="spatially-invariant-deconvolution">
<span id="configuration"></span><h1><span class="section-number">1.2. </span>Spatially invariant deconvolution<a class="headerlink" href="#spatially-invariant-deconvolution" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">1.2.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Deconvolutions when the PSF is constant across the field of view can be carried out using the <code class="docutils literal notranslate"><span class="pre">torchmfbd.Deconvolution</span></code> class.
The following example shows how to deconvolve two objects with a constant PSF. When the anisoplanatic patch is smaller than
the field of view, the deconvolution can be carried out in parallel for all anisoplanatic patches. To this end, the field of view is
mosaicked using the functions provided by torchmfbd v0.1.</p>
<p>Using the following figure from van Noort et al. (2005), <code class="docutils literal notranslate"><span class="pre">torchmfbd.Deconvolution</span></code> can be used to deconvolve a burst
of images taken for different objects and with potentially several phase diversity channels. All objects and diversity
images are assumed to be obtained strictly simultaneously, so that the wavefront is the same for all of them. Diversity
channels differ in a known defocus.</p>
<figure class="align-default">
<img alt="../_images/frames.png" src="../_images/frames.png" />
</figure>
</section>
<section id="example">
<h2><span class="section-number">1.2.2. </span>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<p>The following example shows how to deconvolve a field of view with two objects without a diversity channel. The field of view
is first mosaicked into patches, and the deconvolution is carried out in parallel for each patch. First we define a
configuration file that controls the general behavior of the deconvolution. This configuration file can also
be defined in the code as a dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">telescope</span><span class="p">:</span>
    <span class="n">diameter</span><span class="p">:</span> <span class="mf">100.0</span>
    <span class="n">central_obscuration</span> <span class="p">:</span> <span class="mf">0.0</span>

<span class="n">images</span><span class="p">:</span>
    <span class="n">n_pixel</span> <span class="p">:</span> <span class="mi">64</span>
    <span class="n">pix_size</span> <span class="p">:</span> <span class="mf">0.059</span>
    <span class="n">apodization_border</span> <span class="p">:</span> <span class="mi">6</span>

<span class="n">object1</span><span class="p">:</span>
    <span class="n">wavelength</span> <span class="p">:</span> <span class="mf">8542.0</span>
    <span class="n">image_filter</span><span class="p">:</span> <span class="n">tophat</span>
    <span class="n">cutoff</span> <span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">]</span>

<span class="n">object2</span><span class="p">:</span>
    <span class="n">wavelength</span> <span class="p">:</span> <span class="mf">8542.0</span>
    <span class="n">image_filter</span><span class="p">:</span> <span class="n">tophat</span>
    <span class="n">cutoff</span> <span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">]</span>

<span class="n">optimization</span><span class="p">:</span>
    <span class="n">gpu</span> <span class="p">:</span> <span class="mi">0</span>
    <span class="n">transform</span> <span class="p">:</span> <span class="n">softplus</span>
    <span class="n">softplus_scale</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="n">lr_obj</span> <span class="p">:</span> <span class="mf">0.02</span>
    <span class="n">lr_modes</span> <span class="p">:</span> <span class="mf">0.08</span>
    <span class="n">shod_object_info</span> <span class="p">:</span> <span class="kc">False</span>

<span class="n">regularization</span><span class="p">:</span>
    <span class="n">iuwt1</span><span class="p">:</span>
        <span class="n">variable</span> <span class="p">:</span> <span class="nb">object</span>
        <span class="k">lambda</span> <span class="p">:</span> <span class="mf">0.0</span>
        <span class="n">nbands</span> <span class="p">:</span> <span class="mi">5</span>

<span class="n">psf</span><span class="p">:</span>
    <span class="n">model</span> <span class="p">:</span> <span class="n">kl</span>
    <span class="n">nmax_modes</span> <span class="p">:</span> <span class="mi">44</span>

<span class="n">initialization</span><span class="p">:</span>
    <span class="nb">object</span> <span class="p">:</span> <span class="n">contrast</span>
    <span class="n">modes_std</span> <span class="p">:</span> <span class="mf">0.0</span>

<span class="n">annealing</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">sigmoid</span>
    <span class="n">start_pct</span> <span class="p">:</span> <span class="mf">0.0</span>
    <span class="n">end_pct</span> <span class="p">:</span> <span class="mf">0.85</span>
</pre></div>
</div>
<p>The deconvolution can be carried out by the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deconv</span> <span class="o">=</span> <span class="n">torchmfbd</span><span class="o">.</span><span class="n">Deconvolution</span><span class="p">(</span><span class="s1">&#39;qs_8542_kl_patches.yaml&#39;</span><span class="p">)</span>

<span class="c1"># Patchify and add the frames</span>
<span class="n">frames_patches</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">frames_patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">patchify</span><span class="o">.</span><span class="n">patchify</span><span class="p">(</span><span class="n">frames</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">patch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">stride_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">flatten_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">decSI</span><span class="o">.</span><span class="n">add_frames</span><span class="p">(</span><span class="n">frames_patches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">id_object</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">id_diversity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diversity</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>


<span class="n">deconv</span><span class="o">.</span><span class="n">deconvolve</span><span class="p">(</span><span class="n">infer_object</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
                 <span class="n">simultaneous_sequences</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                 <span class="n">n_iterations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">frames_back</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patchify</span><span class="o">.</span><span class="n">unpatchify</span><span class="p">(</span><span class="n">deconv</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">apodization</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">frames_back</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patchify</span><span class="o">.</span><span class="n">unpatchify</span><span class="p">(</span><span class="n">frames_patches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">apodization</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

<span class="n">npix</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npix</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">npix</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>

<span class="n">deconv</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;output.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we instantiate the <code class="docutils literal notranslate"><span class="pre">torchmfbd.Deconvolution</span></code> class with the configuration file. We then patchify the frames and
add them to the deconvolution object. The field of view is mosaicked into patches of size 64x64 with a stride of 50 pixels, so
that they overlap. The frames are added object by object, indicating the index of the object <code class="docutils literal notranslate"><span class="pre">id_object</span></code> and the index of the
diversity channel <code class="docutils literal notranslate"><span class="pre">id_diversity</span></code>. In this case, we have two objects and no diversity channel, so we set <code class="docutils literal notranslate"><span class="pre">id_diversity=0</span></code> and
<code class="docutils literal notranslate"><span class="pre">diversity=0.0</span></code>. You can add as many objects and diversity channels per object as you want.</p>
<p>The deconvolution is carried out by calling the <code class="docutils literal notranslate"><span class="pre">deconvolve</span></code> method. The method takes several arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">infer_object</span></code>: If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the object is inferred using the analytic solution given by the Wiener filter (see, e.g., van Noort et al. (2005)). Otherwise, the object is inferred by the optimizer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimizer</span></code>: The optimizer to use. The optimizer can be either <code class="docutils literal notranslate"><span class="pre">adam</span></code> (first order Adam) or <code class="docutils literal notranslate"><span class="pre">lbfgs</span></code> (second order L-BFGS, that is more memory and time consuming but more efficient in terms of number of iterations).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simultaneous_sequences</span></code>: The number of patches to deconvolve simultaneously. If you have plenty of VRAM, you can increase this number to speed up the deconvolution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_iterations</span></code>: The number of iterations to carry out.</p></li>
</ul>
</section>
<section id="output">
<h2><span class="section-number">1.2.3. </span>Output<a class="headerlink" href="#output" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2025-02-04 10:17:32,102 - deconvolution  - Using configuration file qs_8542_kl_patches.yaml
2025-02-04 10:17:32,125 - deconvolution  - Computing in NVIDIA GeForce RTX 4090 (free 22.14 GB) - cuda:0
2025-02-04 10:17:32,125 - deconvolution  - Using apodization mask with a border of 6 pixels
2025-02-04 10:17:32,168 - deconvolution  - Telescope
2025-02-04 10:17:32,168 - deconvolution  -   * D: 100.0 m
2025-02-04 10:17:32,168 - deconvolution  -   * pix: 0.059 arcsec
2025-02-04 10:17:32,407 - deconvolution  - Adding frames for object 0 - diversity 0 - defocus 0.0
2025-02-04 10:17:32,407 - deconvolution  - Estimating noise...
2025-02-04 10:17:33,002 - deconvolution  - Adding frames for object 1 - diversity 0 - defocus 0.0
2025-02-04 10:17:33,002 - deconvolution  - Estimating noise...
2025-02-04 10:17:33,542 - deconvolution  -  *****************************************
2025-02-04 10:17:33,543 - deconvolution  -  *** SPATIALLY INVARIANT DECONVOLUTION ***
2025-02-04 10:17:33,543 - deconvolution  -  *****************************************
2025-02-04 10:17:33,543 - deconvolution  - Setting up frames...
2025-02-04 10:17:33,590 - deconvolution  - PSF model: wavefront expansion
2025-02-04 10:17:33,590 - deconvolution  - Found basis file with 44 modes that can be used for 44 modes
2025-02-04 10:17:33,590 - deconvolution  - Loading precomputed KL basis: basis/kl_100cm_64px_8542A_44.npz
2025-02-04 10:17:33,598 - deconvolution  - Wavefront
2025-02-04 10:17:33,598 - deconvolution  -   * Using 44 modes...
2025-02-04 10:17:33,598 - deconvolution  - Wavelength 0 (8542.0 A)
2025-02-04 10:17:33,598 - deconvolution  -   * Diffraction: 0.176191563 arcsec
2025-02-04 10:17:33,598 - deconvolution  -   * Diffraction (x1.22): 0.21495370685999998 arcsec
2025-02-04 10:17:33,607 - deconvolution  - Frames
2025-02-04 10:17:33,607 - deconvolution  -   * Object 0
2025-02-04 10:17:33,607 - deconvolution  -      - Number of sequences 81...
2025-02-04 10:17:33,607 - deconvolution  -      - Number of frames 12...
2025-02-04 10:17:33,607 - deconvolution  -      - Number of diversity channels 1...
2025-02-04 10:17:33,608 - deconvolution  -        -&gt; Diversity 0 = 0.0...
2025-02-04 10:17:33,608 - deconvolution  -      - Size of frames 64 x 64...
2025-02-04 10:17:33,608 - deconvolution  -   * Object 1
2025-02-04 10:17:33,608 - deconvolution  -      - Number of sequences 81...
2025-02-04 10:17:33,608 - deconvolution  -      - Number of frames 12...
2025-02-04 10:17:33,608 - deconvolution  -      - Number of diversity channels 1...
2025-02-04 10:17:33,608 - deconvolution  -        -&gt; Diversity 0 = 0.0...
2025-02-04 10:17:33,608 - deconvolution  -      - Size of frames 64 x 64...
2025-02-04 10:17:33,608 - deconvolution  - Regularization
2025-02-04 10:17:33,608 - deconvolution  - Adding modes using sigmoid schedule
2025-02-04 10:17:33,608 - deconvolution  - Processing sequences [1,14]/81
2025-02-04 10:17:33,629 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:33,630 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 125.04it/s, gpu=16 %, mem=2192.8/24564.0 MB ( 8.9%), active=44, contrast=6.8165, minmax=0.7718/ 1.6871, LMSE=0.040005, LOBJ=0.000000, L=0.0400]
2025-02-04 10:17:33,792 - deconvolution  - Processing sequences [15,28]/81
2025-02-04 10:17:33,792 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:33,792 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 304.56it/s, gpu=16 %, mem=2236.8/24564.0 MB ( 9.1%), active=44, contrast=7.7578, minmax=0.7042/ 1.7335, LMSE=0.045078, LOBJ=0.000000, L=0.0451]
2025-02-04 10:17:33,858 - deconvolution  - Processing sequences [29,42]/81
2025-02-04 10:17:33,858 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:33,858 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 306.41it/s, gpu=16 %, mem=2258.8/24564.0 MB ( 9.2%), active=44, contrast=6.5759, minmax=0.7459/ 1.6867, LMSE=0.042037, LOBJ=0.000000, L=0.0420]
2025-02-04 10:17:33,924 - deconvolution  - Processing sequences [43,55]/81
2025-02-04 10:17:33,936 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:33,936 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 243.11it/s, gpu=35 %, mem=2260.8/24564.0 MB ( 9.2%), active=44, contrast=5.5843, minmax=0.7154/ 1.4883, LMSE=0.038261, LOBJ=0.000000, L=0.0383]
2025-02-04 10:17:34,019 - deconvolution  - Processing sequences [56,68]/81
2025-02-04 10:17:34,019 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:34,019 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 319.36it/s, gpu=35 %, mem=2262.8/24564.0 MB ( 9.2%), active=44, contrast=5.4903, minmax=0.7996/ 1.3550, LMSE=0.036806, LOBJ=0.000000, L=0.0368]
2025-02-04 10:17:34,083 - deconvolution  - Processing sequences [69,81]/81
2025-02-04 10:17:34,083 - deconvolution  - Initializing modes with zeros...
2025-02-04 10:17:34,083 - deconvolution  - Optimizing modes only...
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:00&lt;00:00, 315.16it/s, gpu=35 %, mem=2284.6/24564.0 MB ( 9.3%), active=44, contrast=5.4909, minmax=0.7334/ 1.3897, LMSE=0.036584, LOBJ=0.000000, L=0.0366]
</pre></div>
</div>
<p>Once the deconvolution is finished, several attributes are available in the deconvolution object:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obj</span></code>: The deconvolved objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">obj_diffraction</span></code>: The deconvolved objects convolved with the diffraction-limited PSF.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psf</span></code>: The inferred PSFs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">degraded</span></code>: The object convolved with the inferred PSFs. They can be used to check the quality of the deconvolution because they should be similar to the input frames.</p></li>
</ul>
<p>The mosaicking is undone by calling the <code class="docutils literal notranslate"><span class="pre">unpatchify</span></code> function.</p>
<p>A final call to the <code class="docutils literal notranslate"><span class="pre">write</span></code> method will save the deconvolved objects and the modes to a FITS file.</p>
</section>
<section id="modifying-filter">
<h2><span class="section-number">1.2.4. </span>Modifying filter<a class="headerlink" href="#modifying-filter" title="Link to this heading">¶</a></h2>
<p>The cutoff frequencies of the filters can be modified after deconvolution without the need to redo the deconvolution by using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deconv</span><span class="o">.</span><span class="n">update_object</span><span class="p">(</span><span class="n">cutoffs</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">]])</span>
</pre></div>
</div>
<p>The cutoffs for all objects are passed as a list of lists.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="1.1. Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="deconvolutionSV.html" class="btn btn-neutral float-right" title="1.3. Spatially variant deconvolution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Andres Asensio Ramos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>